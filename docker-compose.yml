version: '2'
services:
  start:
    build:
      context: .
      args:
        - S3_ACCESS_KEY_ID
        - S3_SECRET_ACCESS_KEY
    image: analyticsingestlambda
    command: start
    volumes:
      - .:/app
    env_file:
      - .env
  test:
    image: analyticsingestlambda
    depends_on:
      - "dynamodb-local"
    links:
      - "dynamodb-local"
    command: test
    environment:
      - DDB_LOCAL=dynamodb-local
    volumes:
      - ./bin:/app/bin
      - ./lib:/app/lib
      - ./test:/app/test
      - ./index.js:/app/index.js
  dynamodb-local:
    command: "-jar DynamoDBLocal.jar -sharedDb -dbPath ./data"
    image: "amazon/dynamodb-local:latest"
    container_name: dynamodb-local
    ports:
      - "8000:8000"
    volumes:
      - "./docker/dynamodb:/home/dynamodblocal/data"
    working_dir: /home/dynamodblocal